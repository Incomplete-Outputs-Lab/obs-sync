# 開発ガイド

## マルチインスタンス起動方法（Master/Slaveテスト用）

OBS Syncの動作を確認するには、2つのインスタンスを同時に起動する必要があります。

### 前提条件

1. Node.jsとnpmがインストールされていること
2. Rustがインストールされていること
3. 依存関係がインストールされていること

```bash
npm install
```

### 起動手順

#### ステップ1: 2つのターミナルを開く

**ターミナル1（Master用）:**
```bash
npm run tauri:master
```

**ターミナル2（Slave用）:**
```bash
npm run tauri:slave
```

これにより、2つのインスタンスが異なるポートで起動します：
- Master: ポート1420
- Slave: ポート1421

### 動作確認手順

#### 1. OBS Studioの準備

2つのOBS Studioインスタンスを起動します（異なるポートで）：

**OBS Studio 1（Master用）:**
- WebSocketサーバー設定: ポート4455

**OBS Studio 2（Slave用）:**
- WebSocketサーバー設定: ポート4456（または別のポート）

> **Note:** OBS Studioで複数インスタンスを起動するには、`--multi`オプションを使用するか、異なるプロファイルを作成してください。

#### 2. Masterの設定

**ターミナル1のアプリで:**
1. **Masterモード**を選択
2. OBS接続設定:
   - ホスト: `localhost`
   - ポート: `4455`
   - パスワード: （設定した場合のみ）
3. 「OBSに接続」をクリック
4. 同期対象を選択（ソース、プレビュー、プログラム）
5. 「サーバーを起動」をクリック（デフォルトポート: 8080）

#### 3. Slaveの設定

**ターミナル2のアプリで:**
1. **Slaveモード**を選択
2. OBS接続設定:
   - ホスト: `localhost`
   - ポート: `4456`
   - パスワード: （設定した場合のみ）
3. 「OBSに接続」をクリック
4. Master接続設定:
   - Masterホスト: `localhost`
   - ポート: `8080`
5. 「Masterに接続」をクリック

#### 4. 動作確認

Master側のOBSでシーンを変更すると、Slave側のOBSが自動的に同じシーンに切り替わることを確認してください。

### トラブルシューティング

#### ポートが既に使用されているエラー

```
Failed to start master server: Failed to bind to 0.0.0.0:8080
```

**原因:** 前回起動したサーバーが正しく停止していません。

**解決方法:**
1. アプリで「モードを変更」ボタンをクリック
2. アプリを完全に終了して再起動
3. 別のポート番号を使用（例: 8081）

#### OBSに接続できない

**確認事項:**
- OBS Studioが起動していること
- WebSocketサーバーが有効になっていること
- ポート番号が正しいこと
- ファイアウォールでブロックされていないこと

#### Slaveがマスターに接続できない

**確認事項:**
- Masterサーバーが起動していること
- IPアドレスとポート番号が正しいこと
- 同じネットワーク内にいること
- ファイアウォールでブロックされていないこと

### 開発時のヒント

#### ログの確認

アプリケーションのログは以下のコマンドで確認できます：

```bash
# Rustのログ
RUST_LOG=debug npm run tauri:master

# または
RUST_LOG=debug npm run tauri:slave
```

#### ホットリロード

Viteのホットリロードが有効になっているため、フロントエンドのコードを変更すると自動的にリロードされます。

Rustコードを変更した場合は、アプリを再起動する必要があります。

#### デバッグモード

開発者ツールを開くには、アプリ内で `Ctrl+Shift+I` (Windows/Linux) または `Cmd+Option+I` (macOS) を押してください。

### 単一インスタンスでの開発

機能開発時は単一インスタンスで十分な場合があります：

```bash
npm run tauri dev
```

この場合、デフォルトでポート1420が使用されます。

## ビルド

本番用のバイナリをビルドするには：

```bash
npm run tauri build
```

ビルドされたファイルは `src-tauri/target/release/` に生成されます。
